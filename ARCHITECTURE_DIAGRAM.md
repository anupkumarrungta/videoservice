# Video Translation Service - Architecture Diagram

## System Overview

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           VIDEO TRANSLATION SERVICE                              │
│                              Spring Boot Application                            │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                    FRONTEND                                     │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   Upload Form   │  │  Job Status UI  │  │  Results View   │                  │
│  │   (index.html)  │  │  (job-status)   │  │  (download)     │                  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ HTTP/REST
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                 SPRING BOOT LAYER                               │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  WebController  │  │VideoTranslation │  │  Notification   │                  │
│  │   (REST API)    │  │   Controller    │  │    Service      │                  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ Service Calls
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                 SERVICE LAYER                                   │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   JobManager    │  │VideoProcessing  │  │ Transcription   │                  │
│  │  (Orchestrator) │  │    Service      │  │    Service      │                  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │
│           │                     │                     │                         │
│           │                     │                     │                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   Translation   │  │ AudioSynthesis  │  │   S3Storage     │                  │
│  │    Service      │  │    Service      │  │    Service      │                  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        │ External APIs
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                               EXTERNAL SERVICES                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │
│  │   AWS S3        │  │ AWS Transcribe  │  │   AWS Polly     │                  │
│  │ (File Storage)  │  │ (Speech-to-Text)│  │ (Text-to-Speech)│                  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │
│           │                     │                     │                         │
│           │                     │                     │                         │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐                  │
│  │  AWS Translate  │  │     FFmpeg      │  │   Email/SMTP    │                  │
│  │ (Text Translation)│ │ (Video/Audio)   │  │ (Notifications) │                  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Detailed Component Architecture

### 1. Controller Layer

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                CONTROLLER LAYER                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           WebController                                     │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │   uploadVideo   │  │   getJobStatus  │  │  downloadResult │              │ │
│  │  │   (POST)        │  │    (GET)        │  │    (GET)        │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                      VideoTranslationController                             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │  translateVideo │  │   getProgress   │  │   cancelJob     │              │ │
│  │  │   (POST)        │  │    (GET)        │  │   (DELETE)      │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 2. Service Layer

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                 SERVICE LAYER                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                            JobManager                                       │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │processTranslation│  │  handleJobFailure│  │   retryJob     │              │ │
│  │  │     Job()       │  │      ()         │  │    ()          │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  │                                                                             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │processTargetLang│  │  cleanupJobFiles│  │  getSystemStats │              │ │
│  │  │   uage()        │  │      ()         │  │    ()          │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                        VideoProcessingService                               │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │   extractAudio  │  │splitAudioIntoCh │  │  mergeAudioChunk│              │ │
│  │  │      ()         │  │      unks()     │  │      s()        │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  │                                                                             │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │replaceAudioInVid│  │validateAudioChun│  │  hasAudioStream │              │ │
│  │  │      eo()       │  │      ks()       │  │      ()         │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                         TranscriptionService                                │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │ transcribeAudio │  │transcribeAudioFr│  │downloadAndParse │              │ │
│  │  │      ()         │  │      omS3()     │  │TranscriptionResu│              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                          TranslationService                                 │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │  translateText  │  │translateViaEngli│  │isLanguagePairSup│              │ │
│  │  │      ()         │  │      sh()       │  │      ported()   │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                         AudioSynthesisService                               │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │ synthesizeSpeech│  │detectSpeakerGend│  │getVoiceIdForGen │              │ │
│  │  │      ()         │  │      er()       │  │      der()      │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           S3StorageService                                  │ │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐              │ │
│  │  │   uploadFile    │  │   downloadFile  │  │   deleteFile    │              │ │
│  │  │      ()         │  │      ()         │  │      ()         │              │ │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 3. Data Flow Architecture

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              VIDEO TRANSLATION FLOW                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  1. UPLOAD PHASE                   2. PROCESSING PHASE                         │
│  ┌─────────────────┐               ┌─────────────────────────────────────────┐  │
│  │   Video File    │               │                                         │  │
│  │   Upload        │──────────────▶│  JobManager.processTranslationJob()     │  │
│  │   (S3)          │               │                                         │  │
│  └─────────────────┘               └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │  VideoProcessingService.extractAudio() │  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │VideoProcessingService.splitAudioIntoCh │  │
│           │                        │              unks()                     │  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │  TranscriptionService.transcribeAudio()│  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │  TranslationService.translateText()    │  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │AudioSynthesisService.synthesizeSpeech()│  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │VideoProcessingService.mergeAudioChunks()│  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │VideoProcessingService.replaceAudioInVid│  │
│           │                        │              eo()                      │  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │  S3StorageService.uploadFile()          │  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │  NotificationService.sendJobCompletion │  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │  JobManager.cleanupJobFiles()          │  │
│           │                        └─────────────────────────────────────────┘  │
│           │                                    │                               │
│           │                                    ▼                               │
│           │                        ┌─────────────────────────────────────────┐  │
│           │                        │  Job Status: COMPLETED                  │  │
│           │                        └─────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 4. Configuration Layer

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              CONFIGURATION LAYER                                │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           SecurityConfig                                    │ │
│  │  • CORS Configuration                                                       │ │
│  │  • Security Headers                                                         │ │
│  │  • Authentication (if needed)                                               │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                            AsyncConfig                                      │ │
│  │  • Thread Pool Configuration                                                │ │
│  │  • Async Task Execution                                                     │ │
│  │  • Job Processing Queues                                                    │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                             AwsConfig                                       │ │
│  • AWS SDK Configuration                                                       │ │
│  • S3 Client Setup                                                             │ │
│  • Transcribe Client Setup                                                     │ │
│  • Translate Client Setup                                                      │ │
│  • Polly Client Setup                                                          │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 5. Data Model

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                 DATA MODEL                                      │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                          TranslationJob                                     │ │
│  │  • id (UUID)                                                                │ │
│  │  • originalFilename (String)                                                │ │
│  │  • sourceLanguage (String)                                                  │ │
│  │  • targetLanguages (List<String>)                                           │ │
│  │  • status (JobStatus)                                                       │ │
│  │  • progressPercentage (int)                                                 │ │
│  │  • s3OriginalKey (String)                                                   │ │
│  │  • s3ProcessedKey (String)                                                  │ │
│  │  • userEmail (String)                                                       │ │
│  │  • createdAt (LocalDateTime)                                                │ │
│  │  • updatedAt (LocalDateTime)                                                │ │
│  │  • completedAt (LocalDateTime)                                              │ │
│  │  • errorMessage (String)                                                    │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                        TranslationResult                                    │ │
│  │  • id (UUID)                                                                │ │
│  │  • jobId (UUID)                                                             │ │
│  │  • targetLanguage (String)                                                  │ │
│  │  • status (TranslationStatus)                                               │ │
│  │  • s3VideoKey (String)                                                      │ │
│  │  • s3AudioKey (String)                                                      │ │
│  │  • processingTimeSeconds (long)                                             │ │
│  │  • translationQualityScore (double)                                         │ │
│  │  • audioQualityScore (double)                                               │ │
│  │  • errorMessage (String)                                                    │ │
│  │  • createdAt (LocalDateTime)                                                │ │
│  │  • completedAt (LocalDateTime)                                              │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           DTOs                                              │ │
│  │  • TranslationRequest                                                       │ │
│  │  • TranslationResponse                                                      │ │
│  │  • TranslationResultResponse                                                │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### 6. Error Handling & Resilience

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           ERROR HANDLING & RESILIENCE                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           Retry Mechanisms                                  │ │
│  │  • S3 Upload/Download Retries                                               │ │
│  │  • AWS Service Call Retries                                                 │ │
│  │  • FFmpeg Process Retries                                                   │ │
│  │  • Job Processing Retries                                                   │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           Fallback Strategies                               │ │
│  │  • Audio Extraction Fallback (Direct FFmpeg)                               │ │
│  │  • Audio Chunking Fallback (Single Chunk)                                   │ │
│  │  • Translation Fallback (Via English)                                       │ │
│  │  • Voice Synthesis Fallback (Default Voices)                                │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           Validation Layers                                 │ │
│  │  • Video File Validation                                                    │ │
│  │  • Audio Stream Validation                                                  │ │
│  │  • Audio Chunk Validation                                                   │ │
│  │  • Translation Quality Validation                                           │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐ │
│  │                           Monitoring & Logging                             │ │
│  │  • Comprehensive Logging at Each Step                                       │ │
│  │  • Job Progress Tracking                                                     │ │
│  │  • Error Reporting and Notification                                         │ │
│  │  • Performance Metrics                                                       │ │
│  └─────────────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## Technology Stack

### Backend
- **Framework**: Spring Boot 3.2.0
- **Language**: Java 17
- **Build Tool**: Maven
- **Database**: H2 (Development) / PostgreSQL (Production)
- **ORM**: Hibernate/JPA

### External Services
- **AWS S3**: File Storage
- **AWS Transcribe**: Speech-to-Text
- **AWS Translate**: Text Translation
- **AWS Polly**: Text-to-Speech
- **FFmpeg**: Video/Audio Processing

### Frontend
- **HTML/CSS/JavaScript**: Simple Web Interface
- **Thymeleaf**: Server-side Templating

### Infrastructure
- **Containerization**: Docker
- **Email**: SMTP for Notifications
- **Async Processing**: Spring @Async

## Key Features

1. **Multi-language Support**: 12+ Indian languages + English
2. **Gender-aware Voice Synthesis**: Auto-detection and matching
3. **Lip-sync Enhancement**: Advanced video processing
4. **Asynchronous Processing**: Non-blocking job execution
5. **Comprehensive Error Handling**: Multiple fallback mechanisms
6. **Real-time Progress Tracking**: Job status monitoring
7. **Quality Assurance**: Multiple validation layers
8. **Scalable Architecture**: Microservice-ready design

This architecture provides a robust, scalable, and maintainable solution for video translation with comprehensive error handling and quality assurance mechanisms. 